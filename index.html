<!DOCTYPE html>
<html>
<head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style type="text/css">
        /* Estilos anteriores... */
    </style>
    <!-- Incluir a biblioteca html2pdf.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
    <div>
        <h1 style="text-align: center;">FEEDBACK - OMINI/TALK</h1>
        <table class="text-small">
            <thead>
                <tr class="text-small">
                    <th>C√ìDIGO DO COLABORADOR</th>
                    <th>TME</th>
                    <th>TMA</th>
                    <th>TMIA</th>
                    <th>TAXA DE TRANS</th>
                    <th>AB/PROD</th>
                    <th>PEND√äNCIAS</th>
                    <th>O.S/LOG</th>
                    <th>PER√çODO</th>
                    <th>SEMANA</th>
                </tr>
            </thead>
            <tbody>
                <!-- As linhas da tabela ser√£o preenchidas dinamicamente aqui -->
            </tbody>
        </table>
    </div>

    <!-- Container das assinaturas e data -->
    <div class="signature-container">
        <!-- Assinatura da Supervis√£o -->
        <div class="signature-block">
            <strong class="text-small">Assinatura da Supervis√£o:</strong>
            <button id="open-signature-modal-supervisor" class="signature-button">
                <span class="pencil-icon">‚úèÔ∏è</span>
                <span id="supervisor-signature-line" class="signature-line"></span>
            </button>
        </div>

        <!-- Data -->
        <div class="date-container">
            Data: <span id="current-date"></span>
        </div>

        <!-- Assinatura do Colaborador(a) -->
        <div class="signature-block">
            <strong class="text-small">Assinatura do Colaborador(a):</strong>
            <button id="open-signature-modal-colaborador" class="signature-button">
                <span class="pencil-icon">‚úèÔ∏è</span>
                <span id="colaborador-signature-line" class="signature-line"></span>
            </button>
        </div>
    </div>

    <!-- Bot√µes SALVAR, SALVAR (DRIVER) e ENVIAR -->
    <div style="display: flex; justify-content: center; gap: 20px;">
        <button id="save-button" class="save-button">
            <span class="floppy-icon">üíæ</span>
            SALVAR
        </button>
        <button id="save-driver-button" class="save-driver-button">
            <span class="floppy-icon">üíæ</span>
            SALVAR (DRIVER)
        </button>
        <button id="enviar-button" class="enviar-button">
            <span class="floppy-icon">üì§</span>
            ENVIAR
        </button>
    </div>

    <script>
        // Fun√ß√£o para formatar a data no formato DD/MM/AAAA
        function formatDate(date) {
            const day = String(date.getDate()).padStart(2, '0'); // Dia com 2 d√≠gitos
            const month = String(date.getMonth() + 1).padStart(2, '0'); // M√™s com 2 d√≠gitos
            const year = date.getFullYear(); // Ano com 4 d√≠gitos
            return `${day}/${month}/${year}`; // Retorna a data formatada
        }

        // Fun√ß√£o para exibir a data atual
        function displayCurrentDate() {
            const currentDate = new Date(); // Pega a data atual
            const formattedDate = formatDate(currentDate); // Formata a data
            document.getElementById('current-date').textContent = formattedDate; // Exibe a data
        }

        // Fun√ß√£o para gerar o PDF e abrir o cliente de e-mail
        async function enviarPorEmail() {
            const element = document.body; // Seleciona o corpo da p√°gina
            const options = {
                margin: [10, 10], // Margens do PDF
                filename: 'feedback.pdf', // Nome do arquivo
                image: { type: 'jpeg', quality: 0.98 }, // Qualidade da imagem
                html2canvas: { scale: 2 }, // Escala para melhor qualidade
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' } // Formato A4
            };

            // Gera o PDF como um blob
            const pdfBlob = await html2pdf().from(element).set(options).output('blob');

            // Converte o blob para base64
            const reader = new FileReader();
            reader.readAsDataURL(pdfBlob);
            reader.onloadend = () => {
                const base64Data = reader.result.split(',')[1]; // Remove o prefixo "data:application/pdf;base64,"

                // Cria um link de download tempor√°rio
                const link = document.createElement('a');
                link.href = URL.createObjectURL(pdfBlob);
                link.download = 'feedback.pdf';
                link.click();

                // Abre o cliente de e-mail com o protocolo mailto:
                const emailDestinatario = 'destinatario@example.com'; // Substitua pelo e-mail do destinat√°rio
                const assunto = 'Feedback Gerado'; // Assunto do e-mail
                const corpo = 'Segue em anexo o feedback gerado.'; // Corpo do e-mail

                const mailtoLink = `mailto:${emailDestinatario}?subject=${encodeURIComponent(assunto)}&body=${encodeURIComponent(corpo)}&attachment=${encodeURIComponent(link.href)}`;
                window.location.href = mailtoLink;
            };
        }

        // Adiciona o evento de clique ao bot√£o "Enviar"
        document.getElementById('enviar-button').addEventListener('click', enviarPorEmail);

        // Carrega os dados e exibe a data ao carregar a p√°gina
        window.onload = function () {
            displayCurrentDate(); // Exibe a data atual
        };
    </script>
</body>
</html>
